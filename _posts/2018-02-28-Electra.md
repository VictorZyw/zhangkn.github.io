---
layout: post
title: Electra
date: 2018-02-28
tag: iOSre
site: https://zhangkn.github.io
---

### 前言

Electra iOS 11.0 - 11.1.2 jailbreak toolkit based on async_awake


>* 存放cydia 预留源地址的目录

```
ioast:/private/etc/apt/sources.list.d root# ls -lrt
total 12
-rwxr-xr-x 1 root wheel 227 Feb 16  2017 saurik.list
-rw-r--r-- 1 root wheel  59 Mar  4 19:58 electra-shim.list
-rw-r--r-- 1 root wheel  44 Mar  4 20:05 electra.list
lrwxr-xr-x 1 root wheel  56 Mar  4 21:03 cydia.list -> /var/mobile/Library/Caches/com.saurik.Cydia/sources.list
iRoast:/private/etc/apt/sources.list.d root# cat  electra.list
deb https://electrarepo64.coolstar.org/ ./

iRoast:/private/etc/apt/sources.list.d root# cat  electra-shim.list
deb https://electrarepo64.coolstar.org/substrate-shim/ ./

iRoast:/private/etc/apt/sources.list.d root# cat  saurik.list
# DO NOT EDIT | This is the story of a time long ago, A time of myth and legend, when the Earth was still young.
# The ancient gods were petty and cruel, and they plagued mankind with suffering and beseiged them with terrors. 
iRoast:/private/etc/apt/sources.list.d root# cat cydia.list
deb http://apt.saurik.com/ ios/1445.32 main
deb http://apt.thebigboss.org/repofiles/cydia/ stable main
deb http://cydia.zodttd.com/repo/cydia/ stable main
deb http://repo666.ultrasn0w.com/ ./
deb http://apt.touchsprite.com/ ./
deb http://apt.modmyi.com/ stable main
```

>* dylib 存放的目录
```
iPhone:/usr/lib/TweakInject root# ls -lrt
total 9124
lrwxr-xr-x 1 mobile staff      33 Nov  3  2015 RocketBootstrap.dylib -> /usr/lib/librocketbootstrap.dylib*

<!-- /Layout/Library/MobileSubstrate/DynamicLibraries/ -->
<!-- 此地址已经失效 -->
<!-- librocketbootstrap 要移到这里 -->
```

### 正文

>* [Cydia的首页无法加载，怎么解决？](http://iosre.com/t/cydia/11198)
```
devzkndeMacBook-Pro:zhangkn.github.io devzkn$ scp -r usb2222:/var/preferences/* ~/Dow*
:/var/preferences root# rm -rf *.networkextension*
:/var/preferences root# reboot
```

>* :~ root# cat /etc/hosts,去掉apt.saurik.com 的配置之后，就可以更新deb 目录信息了
```
##
# Host Database
# localhost is used to configure the loopback interface
# when the system is booting.  Do not change this entry.
##
127.0.0.1    localhost
255.255.255.255 broadcasthost
::1      localhost
0.0.0.0    apt.saurik.com
```

### CrashReporter


>* find . -name  'SpringBoard*' -ls
```
12598152   92 -rw-rw-rw-   1 mobile   mobile      94165 Mar 12 16:25 ./private/var/mobile/Library/Logs/CrashReporter/SpringBoard-2018-03-12-162524.ips
```

>* /private/var/mobile/Library/Logs/CrashReporter
```
-rw-rw-rw- 1 mobile mobile 373035 Mar 12 16:09 panic-2018-03-12-160904.ips
-rw-rw-rw- 1 mobile mobile  93633 Mar 12 16:17 SpringBoard-2018-03-12-161753.ips
-rw-rw-rw- 1 mobile mobile  94099 Mar 12 16:18 SpringBoard-2018-03-12-161853.ips
-rw-rw-rw- 1 mobile mobile  93633 Mar 12 16:20 SpringBoard-2018-03-12-162025.ips
-rw-rw-rw- 1 mobile mobile  94015 Mar 12 16:21 SpringBoard-2018-03-12-162151.ips
-rw-rw-rw- 1 mobile mobile  94165 Mar 12 16:25 SpringBoard-2018-03-12-162524.ips
```

### see alse
- [Run HelloWorld on Jailbroken iOS 11](Run HelloWorld on Jailbroken iOS 11)

```
devzkndeMacBook-Pro:knjailbreaktest devzkn$ echo "#include <stdio.h>
> int main()
> {
>     printf("Hello, world!\n");
-bash: !\n": event not found
>     return 0;
> }" > helloworld.c
devzkndeMacBook-Pro:knjailbreaktest devzkn$ cat helloworld.c
#include <stdio.h>
int main()
{
    return 0;
}

<!-- 2、build：devzkndeMacBook-Pro:knjailbreaktest devzkn$ clang -arch arm64 -mios-version-min=10.2 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/ -o helloworld helloworld.c -->

<!-- 3、sign with jtool http://newosxbook.com/tools/jtool.html -->
devzkndeMacBook-Pro:knjailbreaktest devzkn$  ARCH=arm64 jtool --sign --ent ent.xml helloworld

<!-- 4、If this binary is not signed with platform-application entitlement, it will get a ‘Killed’ if it’s under /bin/ -->

<!-- 5、More -->
I wrote a cli based memory editor, which requires more than a hello world.

<!-- 6、patch_setuid() https://github.com/coolstar/electra/blob/master/docs/getting-started.md-->
```

- [https://github.com/coolstar/electra/blob/master/docs/getting-started.md](https://github.com/coolstar/electra/blob/master/docs/getting-started.md)

```
<!-- Major changes in electra -->
1)Substitute is used as the hooking framework instead of substrate
Please report issues at the electra issues page and we'll look into them
2)setuid(0); does not work out of the box (see below for how to use jailbreakd to patch setuid)
3)platform-application WILL NOT platformize your binary out of the box on electra

<!-- jailbreakd -->
/usr/lib/libjailbreak.dylib. All patches here will require dlopen()-ing the dylib, finding the appropiate symbol, and calling the respective function.

<!-- Setting uid 0  Here is sample code to patch setuid() with electra.
  https://github.com/ElectraJailbreak/cydia/blob/master/cydo.cpp#L44-->

 void patch_setuid() {
    void* handle = dlopen("/usr/lib/libjailbreak.dylib", RTLD_LAZY);
    if (!handle) 
        return;

    // Reset errors
    dlerror();
    typedef void (*fix_setuid_prt_t)(pid_t pid);
    fix_setuid_prt_t ptr = (fix_setuid_prt_t)dlsym(handle, "jb_oneshot_fix_setuid_now");
    
    const char *dlsym_error = dlerror();
    if (dlsym_error) 
        return;

    ptr(getpid());
}

<!-- 这个守护进程提权的问题，cool start 的源码是这么用的：https://github.com/ElectraJailbreak/cydia/blob/master/cydo.cpp#L44 -->


```
- [https://discordapp.com/invite/jb](https://discordapp.com/invite/jb)
- [jailbreakcharts](https://www.reddit.com/r/jailbreak/wiki/escapeplan/guides/jailbreakcharts)
- [liberios](http://newosxbook.com/liberios/)

- [https://ageeky.com/cydia-host-unreachable-fixed/](https://ageeky.com/cydia-host-unreachable-fixed/)
- [substitute](https://github.com/coolstar/substitute)
- [electra-ipas](https://github.com/coolstar/electra-ipas)
- [https://coolstar.org/electra/](https://coolstar.org/electra/)
- [https://twitter.com/coolstarorg](https://twitter.com/coolstarorg)

```
For Anemone, make sure to get RocketBootstrap from https://rpetri.ch/repo/


```
- [Electra-1.0.2.zip 修改为.ipa即可](https://github.com/zhangkn/KNiOS-11.0-11.1.2-/blob/master/Electra-1.0.2.zip)
- [iOS's Dispatch Queue](https://xlsn0w.github.io/jekyll/2017/06/22/DispatchQueue/)

```
并行是指两个或者多个事件在同一时刻发生；而并发是指两个或多个事件在同一时间间隔内发生
<!-- 1、应用程序使用以下三种形式调用提交到主队列的block -->
dispatch_main
UIApplicationMain(iOS)
在主队列中使用 CFRunLoopRef
获取主队列的方式：dispatch_get_main_queue()

```
- [Building Responsive and Efficient Apps with GCDhttps://developer.apple.com/videos/play/wwdc2015/718/](https://developer.apple.com/videos/play/wwdc2015/718/)
- [Dispatch](https://developer.apple.com/documentation/dispatch?language=objc)
- [抽离cycript的choose功能](https://github.com/BlueCocoa/choose/)
- [substitute 怎么使用:substitute，它有着和substrate一样的api接口。 ](http://www.alonemonkey.com/2017/05/31/get-start-with-mac-reverse/)
- [ 下载tweak的deb http://ipod-touch-max.ru/cydia/index.php?cat=search&keyword=lighttpd](http://ipod-touch-max.ru/cydia/index.php?cat=search&keyword=lighttpd)