---
layout: post
title: Hopper
date: 2018-03-20
tag: iOSre
site: https://zhangkn.github.io
---


###  前言



### 正文


>* hopper analysis 一个dylib的过程

```
<!--  -->
Hopper is ready
Mach-O ARMv7 file loaded
Starting background analysis
Analysis segment __TEXT
> analysis section __text
> analysis section __picsymbolstub4
> analysis section __stub_helper
> analysis section __gcc_except_tab
> analysis section __objc_methname
> transform section __objc_methname to C strings
> analysis section __ustring
> analysis section __cstring
> transform section __cstring to C strings
> analysis section __objc_classname
> transform section __objc_classname to C strings
> analysis section __objc_methtype
> transform section __objc_methtype to C strings
Analysis segment __DATA
> analysis section __nl_symbol_ptr
> analysis section __la_symbol_ptr
> analysis section __mod_init_func
> analysis section __const
> analysis section __cfstring
> analysis section __objc_classlist
> analysis section __objc_protolist
> analysis section __objc_imageinfo
> analysis section __objc_const
> analysis section __objc_selrefs
> analysis section __objc_classrefs
> analysis section __objc_superrefs
> analysis section __objc_ivar
> analysis section __objc_data
> analysis section __data
> analysis section __bss
Analysis segment __LINKEDIT
Analysis segment External Symbols
> mark procedures
Analysis of segment __TEXT
> analysis of section __text
> disassemble section __text
> searching for additional procedures in section __text
> searching for additional procedures in section __text
> analysis of section __picsymbolstub4
> disassemble section __picsymbolstub4
> searching for additional procedures in section __picsymbolstub4
> searching for additional procedures in section __picsymbolstub4
> analysis of section __stub_helper
> disassemble section __stub_helper
> searching for additional procedures in section __stub_helper
> searching for additional procedures in section __stub_helper
> analysis of section __gcc_except_tab
> analysis of section __objc_methname
> analysis of section __ustring
> analysis of section __cstring
> analysis of section __objc_classname
> analysis of section __objc_methtype
Analysis of segment __DATA
> analysis of section __nl_symbol_ptr
> analysis of section __la_symbol_ptr
> analysis of section __mod_init_func
> analysis of section __const
> analysis of section __cfstring
> analysis of section __objc_classlist
> analysis of section __objc_protolist
> analysis of section __objc_imageinfo
> analysis of section __objc_const
> analysis of section __objc_selrefs
> analysis of section __objc_classrefs
> analysis of section __objc_superrefs
> analysis of section __objc_ivar
> analysis of section __objc_data
> analysis of section __data
> analysis of section __bss
Analysis of segment __LINKEDIT
Analysis of segment External Symbols
> dataflow analysis of procedures in segment __TEXT
> dataflow analysis of procedures in segment __DATA
> dataflow analysis of procedures in segment __LINKEDIT
> dataflow analysis of procedures in segment External Symbols
> searching for additional procedures in section __text
> searching for additional procedures in section __picsymbolstub4
> searching for additional procedures in section __stub_helper
> searching for additional procedures in section __gcc_except_tab
> searching for additional procedures in section __objc_methname
> searching for additional procedures in section __ustring
> searching for additional procedures in section __cstring
> searching for additional procedures in section __objc_classname
> searching for additional procedures in section __objc_methtype
> searching for additional procedures in section __nl_symbol_ptr
> searching for additional procedures in section __la_symbol_ptr
> searching for additional procedures in section __mod_init_func
> searching for additional procedures in section __const
> searching for additional procedures in section __cfstring
> searching for additional procedures in section __objc_classlist
> searching for additional procedures in section __objc_protolist
> searching for additional procedures in section __objc_imageinfo
> searching for additional procedures in section __objc_const
> searching for additional procedures in section __objc_selrefs
> searching for additional procedures in section __objc_classrefs
> searching for additional procedures in section __objc_superrefs
> searching for additional procedures in section __objc_ivar
> searching for additional procedures in section __objc_data
> searching for additional procedures in section __data
> searching for additional procedures in section __bss
> dataflow analysis of procedures in segment __TEXT
> dataflow analysis of procedures in segment __DATA
> dataflow analysis of procedures in segment __LINKEDIT
> dataflow analysis of procedures in segment External Symbols
Background analysis ended in 10308ms
```

### see also

- [ Anti Reverse Engeering PASS。 https://github.com/xiangzhai/dragonball/blob/master/lib/Transforms/ARE/ARE.cpp](https://github.com/xiangzhai/dragonball/blob/master/lib/Transforms/ARE/ARE.cpp)



- [关于移动安全的一点总结](https://www.jianshu.com/p/62b925d31c5d)

```
<!-- 2.1:静态分析防护 -->

1.对抗hopper和ida的分析可以修改macho文件的某些偏移量, 让hopper和ida无法分析造成闪退

2.对抗class-dump 和工具分析可以方法名类名混淆,混淆方案大致三种
        1.编译前用脚本批量做宏定义替换
        2.LLVM混淆
        3.对Mach-O__objc_classnamehe __objc_methname

3.逻辑混淆(花指令)

<!-- 2.2:动态分析防护 -->

1.ptrace ,syscall sysctl,dlsym等

<!-- 2.3:动态注入防护 -->

1.__RESTRICT关联main函数: 用getsectiondata关联__RESTRICT

2.dladdr查看函数的内存空间信息, 验证函数的指针来自程序, 还是苹果的库, 还是未知.

<!-- 2.6:重签名防护 -->

1.拿到当前的签名文件的签名信息和编译前的签名信息比对

```
